Le dossier utils/ contient les fonctions utilitaires et constantes globales utilisÃ©es dans tout le frontend DroneWeb.
Ces fichiers servent Ã  :

    Centraliser les valeurs fixes (URLs, champs affichÃ©sâ€¦)

    Fournir des fonctions communes de formatage et dâ€™extraction

    Encapsuler la logique technique rÃ©currente (requÃªtes GraphQL, calculs de distanceâ€¦)

    Centraliser les ressources dâ€™UI (icÃ´nes Leaflet)

1ï¸âƒ£ constants.ts
ğŸ¯ RÃ´le

Contient toutes les constantes rÃ©utilisables dans lâ€™application :

    URLs dâ€™API

    Champs affichÃ©s dans les tables et panneaux

    ParamÃ¨tres globaux (pagination)

ğŸ“¦ Contenu

    GRAPHQL_URL, HISTORY_URL, ANCHOR_URL â†’ URLs des services backend

    LIVE_FIELDS â†’ colonnes affichÃ©es dans les tables live

    HISTORY_API_FIELDS â†’ colonnes affichÃ©es pour lâ€™historique API

    LIVE_DETAILS, EVENT_DETAILS â†’ champs dÃ©taillÃ©s pour panneaux de dÃ©tails live/historique

    PER_PAGE â†’ taille par page pour pagination

    logConstantsAccess() â†’ fonction pour tracer lâ€™accÃ¨s aux constantes

ğŸ“Œ Notes

    Dans notre version optimisÃ©e, ces URLs reposent sur API_BASE_URL dÃ©fini via .env

    Les listes de champs peuvent Ãªtre marquÃ©es as const pour un typage plus strict

2ï¸âƒ£ coords.ts
ğŸ¯ RÃ´le

GÃ¨re lâ€™extraction et la manipulation des coordonnÃ©es GPS utilisÃ©es dans le projet :

    RÃ©cupÃ©ration des traces de vols

    Parsing de strings JSON en listes de points

    Correspondance traces/Ã©vÃ©nements par ID ou distance

ğŸ“¦ Fonctions

    LatLng â†’ type [lat, lng]

    getFlightTrace(flight)
    RÃ©cupÃ¨re une liste de [lat,lng] depuis flight.trace (tableau ou JSON) ou tracing.points

    parseTracePoints(str)
    Parse une chaÃ®ne JSON en tableau LatLng[]

    findMatchingTrace(traces, event, maxDistanceMeters)
    Cherche une trace correspondant Ã  un Ã©vÃ©nement par ID ou proximitÃ© (Haversine)

    haversineDistance(lat1,lon1,lat2,lon2) (dans version optimisÃ©e)
    Calcule distance en mÃ¨tres

ğŸ“Œ Notes

    Gestion robuste des formats inattendus

    Logs filtrables via un paramÃ¨tre debug

    isLatLng() permet de valider un point [number, number]

3ï¸âƒ£ format.ts
ğŸ¯ RÃ´le

Fonctions de formatage dâ€™affichage des donnÃ©es pour lâ€™UI.
ğŸ“¦ Fonctions

    formatDate(dateStr)
    Formate une date ISO/timestamp en format fr-FR lisible
    Ignore ou renvoie vide si invalide

    prettyValue(key, value)
    Adapte lâ€™affichage selon la clÃ© :

        boolean â†’ Oui / Non

        Champ date/time â†’ passe par formatDate

        Altitude/distance â†’ ajoute m

        Vitesse â†’ ajoute m/s

        SÃ©vÃ©ritÃ© â†’ mapping vers texte

        Tableau â†’ jointure par virgules

        Objet {lat,lng} â†’ affichage coordonnÃ©e

        Objet gÃ©nÃ©rique â†’ JSON.stringify ou safeStringify

ğŸ“Œ Notes

    Logs contrÃ´lÃ©s par DEBUG flag

    Mapping SEVERITY_LABELS peut Ãªtre externalisÃ© dans constants.ts

    Toutes les conversions passent par String() pour Ã©viter erreurs dâ€™affichage

4ï¸âƒ£ graphql.ts
ğŸ¯ RÃ´le

Centralise :

    Les requÃªtes GraphQL brutes (queries statiques)

    La gÃ©nÃ©ration dynamique de queries

    Lâ€™exÃ©cution des requÃªtes avec fetchGraphQL

ğŸ“¦ Contenu

    DRONE_QUERY â†’ infos dÃ©taillÃ©es dâ€™un drone

    EVENT_HISTORY_GRAPHQL â†’ historique Ã©vÃ©nements triÃ© par date

    DRONETRACES_GRAPHQL(from,to) â†’ requÃªte dynamique pour traces

    fetchGraphQL(query, url?, headers?) â†’ fonction gÃ©nÃ©rique POST GraphQL

        GÃ¨re erreurs HTTP (!ok)

        GÃ¨re erreurs GraphQL (errors dans reponse)

        Retour typable <T>

ğŸ“Œ Notes

    GRAPHQL_URL est importÃ© de constants.ts

    IdÃ©alement sÃ©parer queries pures dans un queries.ts

5ï¸âƒ£ icons.ts
ğŸ¯ RÃ´le

Stocke toutes les icÃ´nes Leaflet utilisÃ©es par applicatif, avec configuration standardisÃ©e.
ğŸ“¦ Contenu

    droneIcon â†’ icÃ´ne PNG pour drones live

    historyIcon â†’ icÃ´ne PNG pour historiques

ğŸ“Œ Notes

    ParamÃ¨tres communs (iconSize, iconAnchor, popupAnchor) peuvent Ãªtre mis dans une fonction createIcon() pour Ã©viter rÃ©pÃ©titions

    URLs centralisÃ©es dans un objet ICON_URLS pour modification facile

ğŸ›  Bonnes pratiques pour utils/

    Centraliser les paramÃ¨tres/env dans constants.ts

    DÃ©bug dÃ©sactivÃ© en prod via process.env.NODE_ENV

    Fonctions pures â†’ aucun effet de bord non contrÃ´lÃ©, pour un test unitaire facile

    Typage strict (as const, gardes de type)
